<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Create Booking | TrainLink</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        body {
            background: #f5f7fa;
            font-family: 'Inter', sans-serif;
            position: relative;
        }

        /* Top navigation button */
        .top-right-btn {
            position: absolute;
            top: 20px;
            right: 30px;
        }

        .btn-dashboard {
            background-color: #0d6efd;
            color: #fff;
            font-weight: 600;
            border: none;
            border-radius: 8px;
            padding: 10px 18px;
            transition: all 0.3s ease;
            text-decoration: none;
        }

        .btn-dashboard:hover {
            background-color: #0b5ed7;
            color: #fff;
        }

        .booking-card {
            max-width: 700px;
            margin: 80px auto;
            padding: 40px;
            border-radius: 15px;
            background: #ffffff;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        .booking-card h2 {
            font-weight: 700;
            color: #333333;
            text-align: center;
            margin-bottom: 30px;
        }

        .form-label {
            font-weight: 500;
            color: #555555;
        }

        .form-select, .form-control {
            border-radius: 8px;
            padding: 12px 15px;
            border: 1px solid #ced4da;
            transition: all 0.3s ease;
        }

        .form-select:focus, .form-control:focus {
            box-shadow: 0 0 0 0.2rem rgba(13,110,253,.25);
            border-color: #0d6efd;
        }

        .btn-primary {
            background-color: #0d6efd;
            border: none;
            font-weight: 600;
            font-size: 16px;
            padding: 12px;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            background-color: #0b5ed7;
        }

        .section-divider {
            border-top: 1px solid #e2e2e2;
            margin: 25px 0;
        }

        #price {
            font-weight: 600;
            color: #0d6efd;
        }
    </style>
</head>
<body>

<!-- Back to Dashboard Button -->
<div class="top-right-btn">
    <a th:href="@{/passenger/dashboard}" class="btn-dashboard">
        ‚Üê Back to Dashboard
    </a>
</div>

<div class="booking-card">
    <h2>Train Ticket Booking</h2>

    <form th:action="@{/booking/create}" method="post">
        <!-- Route Selection -->
        <div class="mb-4">
            <label for="routeId" class="form-label">Select Route</label>
            <select id="routeId" name="routeId" class="form-select" required>
                <option value="">-- Select Route --</option>
                <option th:each="route : ${routes}"
                        th:value="${route.routeId}"
                        th:text="${route.routeName}">
                </option>
            </select>
        </div>

        <!-- Available Time -->
        <div class="mb-4">
            <label for="availableTime" class="form-label">Available Time</label>
            <input type="text" id="availableTime" name="availableTime" class="form-control" readonly>
        </div>

        <div class="section-divider"></div>

        <!-- Train Selection -->
        <div class="mb-4">
            <label for="trainId" class="form-label">Select Train</label>
            <select id="trainId" name="trainId" class="form-select" required>
                <option value="">-- Select Train --</option>
            </select>
        </div>

        <!-- Class Selection -->
        <div class="mb-4">
            <label for="classType" class="form-label">Select Class</label>
            <select id="classType" name="classType" class="form-select" required>
                <option value="">-- Select Class --</option>
                <option value="First">First Class (Rs. 2500)</option>
                <option value="Second">Second Class (Rs. 1500)</option>
                <option value="Third">Third Class (Rs. 800)</option>
            </select>
        </div>

        <div class="section-divider"></div>

        <!-- Travel Date -->
        <div class="mb-4">
            <label for="travelDate" class="form-label">Travel Date</label>
            <input type="date" id="travelDate" name="travelDate" class="form-control" required>
        </div>

        <div class="mb-4">
            <label for="numSeats" class="form-label">Number of Seats</label>
            <input type="number" id="numSeats" name="numSeats" class="form-control" min="1" max="10" value="1" required>
        </div>


        <!-- Price Display -->
        <div class="mb-4">
            <label for="price" class="form-label">Ticket Price</label>
            <input type="text" id="price" class="form-control" readonly>
        </div>

        <!-- Submit Button -->
        <button type="submit" class="btn btn-primary w-100">Book Now</button>
    </form>
</div>

<script>
    const CLASS_PRICES = { A: 2500, B: 1500, C: 800 };

    // When route is selected
    $('#routeId').on('change', function() {
        const routeId = $(this).val();
        $('#trainId').empty().append('<option value="">-- Select Train --</option>');
        $('#availableTime').val('');
        if (routeId) {
            $.get('/booking/getTrainsAndTime', { routeId: routeId }, function(data) {
                if (data.trains) {
                    $.each(data.trains, function(i, train) {
                        $('#trainId').append('<option value="' + train.tid + '">' + train.name + '</option>');
                    });
                }
                $('#availableTime').val(data.availableTime || 'N/A');
            });
        }
    });

    // Update price when class is selected
    $('#classType, #numSeats').on('change', function() {
        const selectedClass = $('#classType').val();
        const numSeats = parseInt($('#numSeats').val()) || 1;
        if(selectedClass) {
            const totalPrice = CLASS_PRICES[selectedClass] * numSeats;
            $('#price').val(`Rs. ${totalPrice.toLocaleString()}`);
        } else {
            $('#price').val('');
        }
    });

</script>

</body>
</html>
